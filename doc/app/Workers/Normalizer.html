<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">

<title>class Workers::Normalizer - Rails Application Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Object.html">Object</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-build_aacc_eod_csv_trade_id">::build_aacc_eod_csv_trade_id</a>
    
    <li ><a href="#method-c-normalize">::normalize</a>
    
    <li ><a href="#method-c-normalize_abn_fix_42">::normalize_abn_fix_42</a>
    
    <li ><a href="#method-c-normalize_abn_pos_csv">::normalize_abn_pos_csv</a>
    
    <li ><a href="#method-c-normalize_baseline_report">::normalize_baseline_report</a>
    
    <li ><a href="#method-c-normalize_cme_eod">::normalize_cme_eod</a>
    
    <li ><a href="#method-c-normalize_cme_itd_fixml">::normalize_cme_itd_fixml</a>
    
    <li ><a href="#method-c-normalize_itd_abn_csv">::normalize_itd_abn_csv</a>
    
    <li ><a href="#method-c-reformat_aacc_eod_csv_time">::reformat_aacc_eod_csv_time</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Workers::Normalizer">
  <h1 id="class-Workers::Normalizer" class="class">
    class Workers::Normalizer
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="GMI2CLR">GMI2CLR
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-build_aacc_eod_csv_trade_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_aacc_eod_csv_trade_id</span><span
            class="method-args">(hash)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_aacc_eod_csv_trade_id-source">
            <pre><span class="ruby-comment"># File app/models/workers/normalizer.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">build_aacc_eod_csv_trade_id</span>(<span class="ruby-identifier">hash</span>)
  [<span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">18</span>],].<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;:&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-normalize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">normalize</span><span
            class="method-args">(params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="normalize-source">
            <pre><span class="ruby-comment"># File app/models/workers/normalizer.rb, line 27</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">normalize</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;49&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/(AACC|EAGLE_MARKET_MAKERS)/</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;8&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;FIX.4.2&#39;</span>
    <span class="ruby-identifier">normalize_abn_fix_42</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Do not know how to normalize #{params[&#39;49&#39;]} #{params[&#39;8&#39;]}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-normalize_abn_fix_42" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">normalize_abn_fix_42</span><span
            class="method-args">(params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>&lt;FIXML&gt;</p>

<pre>&lt;TrdCaptRpt RptID=&quot;353795&quot; CopyMsgInd=&quot;Y&quot; TrdRptStat=&quot;0&quot; TrdID=&quot;4106894&quot; LastPx=&quot;314.25&quot; LastQty=&quot;1&quot; TrdDt=&quot;2016-01-28&quot; BizDt=&quot;2016-01-28&quot; TxnTm=&quot;2016-01-28T11:29:36-05:00&quot; TrdTyp=&quot;0&quot; MtchStat=&quot;0&quot; VenuTyp=&quot;E&quot; ExecID=&quot;12713436&quot; MLegRptTyp=&quot;2&quot; TrdPubInd=&quot;1&quot; RptTyp=&quot;0&quot; TransTyp=&quot;0&quot;&gt;
   &lt;Hdr Snt=&quot;2016-01-28T11:29:37-05:00&quot; SID=&quot;ICE&quot; TID=&quot;FCR&quot; /&gt;
   &lt;RegTrdID Typ=&quot;0&quot; ID=&quot;10000000000000000000000000NYZW58&quot; Src=&quot;1010000180&quot; Evnt=&quot;2&quot; /&gt;
   &lt;TrdRegTS Typ=&quot;19&quot; TS=&quot;2016-01-28T11:29:37.385-05:00&quot; /&gt;
   &lt;TrdRegTS Typ=&quot;1&quot; TS=&quot;2016-01-28T11:29:37.381-05:00&quot; /&gt;
   &lt;Pty R=&quot;73&quot; ID=&quot;IFEU&quot; /&gt;
   &lt;Instrmt ID=&quot;G&quot; SecTyp=&quot;FUT&quot; MMY=&quot;201603&quot; =&quot;IFEU&quot; SubTyp=&quot;99&quot; /&gt;
   &lt;RptSide Side=&quot;1&quot; OrdID=&quot;12713418&quot; ClOrdID2=&quot;521539299&quot; AgrsrInd=&quot;Y&quot; ClOrdID=&quot;201197609609&quot; InptSrc=&quot;ICE&quot; InptDev=&quot;ICE&quot; PosEfct=&quot;O&quot; StrategyLinkID=&quot;12713418&quot;&gt;
      &lt;Pty R=&quot;12&quot; ID=&quot;JHG&quot; /&gt;
      &lt;Pty R=&quot;21&quot; ID=&quot;ICEU&quot; /&gt;
      &lt;Pty R=&quot;4&quot; ID=&quot;FCR&quot; /&gt;
      &lt;Pty R=&quot;1&quot; ID=&quot;FCR&quot; /&gt;
      &lt;Pty R=&quot;22&quot; ID=&quot;IFEU&quot; /&gt;
      &lt;Pty R=&quot;38&quot; ID=&quot;W&quot;&gt;</pre>

<p>&lt;/FIXML&gt;</p>
          
          

          
          <div class="method-source-code" id="normalize_abn_fix_42-source">
            <pre><span class="ruby-comment"># File app/models/workers/normalizer.rb, line 312</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">normalize_abn_fix_42</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">system</span> = <span class="ruby-constant">System</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;AACC&#39;</span>)
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:system</span>] = <span class="ruby-identifier">system</span>

  <span class="ruby-identifier">entity</span> = <span class="ruby-constant">Entity</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;EMM&#39;</span>)
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:entity</span>] = <span class="ruby-identifier">entity</span>

  <span class="ruby-identifier">dealing_venue_alias</span> = <span class="ruby-constant">DealingVenueAlias</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">system_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">system</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">code</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;207&#39;</span>]).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">dealing_venue</span> = <span class="ruby-identifier">dealing_venue_alias</span>.<span class="ruby-identifier">dealing_venue</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:dealing_venue</span>] = <span class="ruby-identifier">dealing_venue</span>

  <span class="ruby-identifier">account</span> = <span class="ruby-constant">Builders</span><span class="ruby-operator">::</span><span class="ruby-constant">AccountBuilder</span>.<span class="ruby-identifier">build_from_aacc_fix_42</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">claim</span> = <span class="ruby-constant">Builders</span><span class="ruby-operator">::</span><span class="ruby-constant">ClaimBuilder</span>.<span class="ruby-identifier">build_from_aacc_fix_42</span>(<span class="ruby-identifier">params</span>)

  <span class="ruby-identifier">hash</span> = {
      <span class="ruby-identifier">account_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">system_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">system</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">entity_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">entity</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">claim_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">claim</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">done</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;54&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;1&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;32&#39;</span>] <span class="ruby-operator">:</span> <span class="ruby-string">&#39;-&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;32&#39;</span>],
      <span class="ruby-identifier">price</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;31&#39;</span>],
      <span class="ruby-identifier">price_traded</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;31&#39;</span>],
      <span class="ruby-identifier">posted_on</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;75&#39;</span>],
      <span class="ruby-identifier">traded_on</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;75&#39;</span>],
      <span class="ruby-identifier">traded_at</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;60&#39;</span>],
      <span class="ruby-identifier">dealing_venue_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">dealing_venue</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">dealing_venue_done_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;17&#39;</span>]
  }

  <span class="ruby-identifier">hash</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-normalize_abn_pos_csv" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">normalize_abn_pos_csv</span><span
            class="method-args">(line, posted_on)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="normalize_abn_pos_csv-source">
            <pre><span class="ruby-comment"># File app/models/workers/normalizer.rb, line 35</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">normalize_abn_pos_csv</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">posted_on</span>)
  <span class="ruby-identifier">hash</span> = {}
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>] = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>)

  <span class="ruby-identifier">ary</span> = <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>]

  <span class="ruby-identifier">ary</span>.<span class="ruby-identifier">each_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ary</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">ary</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">strip</span> }

  <span class="ruby-comment"># replace GMI symbol with CLR symbol if known</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ary</span>[<span class="ruby-value">11</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;05&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">ary</span>[<span class="ruby-value">12</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;SF&#39;</span>
    <span class="ruby-comment"># LIFFE</span>
    <span class="ruby-identifier">ary</span>[<span class="ruby-value">12</span>]= <span class="ruby-string">&#39;I&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">ary</span>[<span class="ruby-value">11</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;27&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">ary</span>[<span class="ruby-value">12</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;SF&#39;</span>
    <span class="ruby-comment"># EUREX</span>
    <span class="ruby-identifier">ary</span>[<span class="ruby-value">12</span>] = <span class="ruby-string">&#39;FESX&#39;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">key</span> = <span class="ruby-identifier">ary</span>[<span class="ruby-value">12</span>]
    <span class="ruby-identifier">ary</span>[<span class="ruby-value">12</span>] = <span class="ruby-constant">GMI2CLR</span>[<span class="ruby-identifier">key</span>] <span class="ruby-keyword">if</span> <span class="ruby-constant">GMI2CLR</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">key</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">system</span> = <span class="ruby-constant">System</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;AACC&#39;</span>)
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:system</span>] = <span class="ruby-identifier">system</span>

  <span class="ruby-identifier">entity</span> = <span class="ruby-constant">Entity</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;EMM&#39;</span>)
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:entity</span>] = <span class="ruby-identifier">entity</span>

  <span class="ruby-identifier">dealing_venue_alias_code</span> = <span class="ruby-identifier">ary</span>[<span class="ruby-value">11</span>]

  <span class="ruby-identifier">dealing_venue_alias</span> = <span class="ruby-constant">DealingVenueAlias</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">system_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">system</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">code</span><span class="ruby-operator">:</span> <span class="ruby-identifier">dealing_venue_alias_code</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:dealing_venue</span>] = <span class="ruby-identifier">dealing_venue_alias</span>.<span class="ruby-identifier">dealing_venue</span>

  <span class="ruby-identifier">acc_code</span> = <span class="ruby-constant">Builders</span><span class="ruby-operator">::</span><span class="ruby-constant">AccountBuilder</span>.<span class="ruby-identifier">aacc_account_alias_mundger</span>(<span class="ruby-identifier">ary</span>[<span class="ruby-value">10</span>])
  <span class="ruby-identifier">account</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">acc_code</span>)
  <span class="ruby-comment"># account = Builders::AccountBuilder.build_from_aacc_eod_csv(hash)</span>
  <span class="ruby-identifier">claim</span> = <span class="ruby-constant">Builders</span><span class="ruby-operator">::</span><span class="ruby-constant">ClaimBuilder</span>.<span class="ruby-identifier">build_from_abn_pos_csv</span>(<span class="ruby-identifier">hash</span>)

  <span class="ruby-identifier">side</span> = <span class="ruby-identifier">ary</span>[<span class="ruby-value">20</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;1&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-value">+1</span> <span class="ruby-operator">:</span> <span class="ruby-value">-1</span>

  <span class="ruby-identifier">hash</span> = {
      <span class="ruby-identifier">account_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">system_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">system</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">entity_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">entity</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">claim_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">claim</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">done</span><span class="ruby-operator">:</span> <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">ary</span>[<span class="ruby-value">21</span>]) <span class="ruby-operator">*</span> <span class="ruby-identifier">side</span>,
      <span class="ruby-identifier">price</span><span class="ruby-operator">:</span> <span class="ruby-identifier">ary</span>[<span class="ruby-value">65</span>],
      <span class="ruby-identifier">price_traded</span><span class="ruby-operator">:</span> <span class="ruby-identifier">ary</span>[<span class="ruby-value">65</span>],
      <span class="ruby-identifier">posted_on</span><span class="ruby-operator">:</span> <span class="ruby-identifier">posted_on</span>,
      <span class="ruby-identifier">traded_on</span><span class="ruby-operator">:</span> <span class="ruby-identifier">posted_on</span>,
      <span class="ruby-identifier">traded_at</span><span class="ruby-operator">:</span> <span class="ruby-identifier">reformat_aacc_eod_csv_time</span>(<span class="ruby-identifier">ary</span>[<span class="ruby-value">54</span>]),
      <span class="ruby-identifier">dealing_venue_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:dealing_venue</span>].<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">dealing_venue_done_id</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{posted_on} #{ary[2]}&quot;</span>,

      <span class="ruby-identifier">packer_report_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:packer_report_id</span>],
      <span class="ruby-identifier">root</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:root</span>]
  }

  <span class="ruby-identifier">hash</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-normalize_baseline_report" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">normalize_baseline_report</span><span
            class="method-args">(report)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="normalize_baseline_report-source">
            <pre><span class="ruby-comment"># File app/models/workers/normalizer.rb, line 344</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">normalize_baseline_report</span>(<span class="ruby-identifier">report</span>)

  <span class="ruby-identifier">account_code</span>, <span class="ruby-identifier">posted_on</span>, <span class="ruby-identifier">done</span>, <span class="ruby-identifier">claim_code</span>, <span class="ruby-identifier">price</span> = <span class="ruby-identifier">report</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39; &#39;</span>)

  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">claim_code</span>

  <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">posted_on</span>)
  <span class="ruby-identifier">venue</span> = <span class="ruby-constant">DealingVenue</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">claim_code</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:&#39;</span>).<span class="ruby-identifier">first</span>)
  <span class="ruby-identifier">claim</span> = <span class="ruby-constant">Claim</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">claim_code</span>)
  <span class="ruby-identifier">system</span> = <span class="ruby-constant">System</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;BKO&#39;</span>)
  <span class="ruby-identifier">entity</span> = <span class="ruby-constant">Entity</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;EMM&#39;</span>)
  <span class="ruby-identifier">account</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">account_code</span>)

  <span class="ruby-identifier">hash</span> = {
      <span class="ruby-identifier">account_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">system_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">system</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">entity_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">entity</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">claim_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">claim</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">done</span><span class="ruby-operator">:</span> <span class="ruby-identifier">done</span>,
      <span class="ruby-identifier">price</span><span class="ruby-operator">:</span> <span class="ruby-identifier">price</span>,
      <span class="ruby-identifier">price_traded</span><span class="ruby-operator">:</span> <span class="ruby-identifier">price</span>,
      <span class="ruby-identifier">posted_on</span><span class="ruby-operator">:</span> <span class="ruby-identifier">date</span>,
      <span class="ruby-identifier">traded_on</span><span class="ruby-operator">:</span> <span class="ruby-identifier">date</span>,
      <span class="ruby-identifier">traded_at</span><span class="ruby-operator">:</span> <span class="ruby-identifier">date</span>,
      <span class="ruby-identifier">dealing_venue_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">venue</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">dealing_venue_done_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">rand</span>(<span class="ruby-value">1_000_000_000</span>)
  }

  <span class="ruby-identifier">hash</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-normalize_cme_eod" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">normalize_cme_eod</span><span
            class="method-args">(params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>{“FIXML”=&gt;</p>

<pre>{&quot;TrdCaptRpt&quot;=&gt;
  {&quot;RptID&quot;=&gt;&quot;21937832663&quot;,
   &quot;TrdTyp&quot;=&gt;&quot;0&quot;,
   &quot;TrdSubTyp&quot;=&gt;&quot;7&quot;,
   &quot;ExecID&quot;=&gt;&quot;87472920160720190002TN0000015&quot;,
   &quot;TrdDt&quot;=&gt;&quot;2016-07-21&quot;,
   &quot;BizDt&quot;=&gt;&quot;2016-07-21&quot;,
   &quot;MLegRptTyp&quot;=&gt;&quot;2&quot;,
   &quot;MtchStat&quot;=&gt;&quot;0&quot;,
   &quot;MsgEvtSrc&quot;=&gt;&quot;REG&quot;,
   &quot;TrdID&quot;=&gt;&quot;100432&quot;,
   &quot;LastQty&quot;=&gt;&quot;1&quot;,
   &quot;LastPx&quot;=&gt;&quot;347.7&quot;,
   &quot;TxnTm&quot;=&gt;&quot;2016-07-20T19:00:02-05:00&quot;,
   &quot;SettlCcy&quot;=&gt;&quot;USD&quot;,
   &quot;SettlDt&quot;=&gt;&quot;2016-12-14&quot;,
   &quot;OrigTrdID&quot;=&gt;&quot;155FADF8568LTP0202D90652A&quot;,
   &quot;PxSubTyp&quot;=&gt;&quot;1&quot;,
   &quot;VenueTyp&quot;=&gt;&quot;E&quot;,
   &quot;VenuTyp&quot;=&gt;&quot;E&quot;,
   &quot;Instrmt&quot;=&gt;
    {&quot;ID&quot;=&gt;&quot;06&quot;,
     &quot;Desc&quot;=&gt;&quot;SOYBEAN MEAL FUTURES&quot;,
     &quot;CFI&quot;=&gt;&quot;FCAPSO&quot;,
     &quot;SecTyp&quot;=&gt;&quot;FUT&quot;,
     &quot;MMY&quot;=&gt;&quot;201612&quot;,
     &quot;MatDt&quot;=&gt;&quot;2016-12-14&quot;,
     &quot;Mult&quot;=&gt;&quot;100&quot;,
     &quot;Exch&quot;=&gt;&quot;CBT&quot;,
     &quot;UOM&quot;=&gt;&quot;tn&quot;,
     &quot;UOMQty&quot;=&gt;&quot;100&quot;,
     &quot;PxUOM&quot;=&gt;&quot;TON&quot;,
     &quot;PxUOMQty&quot;=&gt;&quot;1&quot;,
     &quot;ValMeth&quot;=&gt;&quot;FUT&quot;,
     &quot;Fctr&quot;=&gt;&quot;1&quot;,
     &quot;PxQteCcy&quot;=&gt;&quot;USD&quot;},
   &quot;Amt&quot;=&gt;{&quot;Typ&quot;=&gt;&quot;TVAR&quot;, &quot;Amt&quot;=&gt;&quot;20&quot;, &quot;Ccy&quot;=&gt;&quot;USD&quot;},
   &quot;RptSide&quot;=&gt;
    {&quot;Side&quot;=&gt;&quot;2&quot;,
     &quot;ClOrdID&quot;=&gt;&quot;17W9&quot;,
     &quot;CustCpcty&quot;=&gt;&quot;2&quot;,
     &quot;OrdTyp&quot;=&gt;&quot;L&quot;,
     &quot;SesID&quot;=&gt;&quot;EOD&quot;,
     &quot;SesSub&quot;=&gt;&quot;E&quot;,
     &quot;AllocInd&quot;=&gt;&quot;0&quot;,
     &quot;AgrsrInd&quot;=&gt;&quot;Y&quot;,
     &quot;Pty&quot;=&gt;
      [{&quot;ID&quot;=&gt;&quot;CME&quot;, &quot;R&quot;=&gt;&quot;21&quot;},
       {&quot;ID&quot;=&gt;&quot;353&quot;, &quot;R&quot;=&gt;&quot;4&quot;},
       {&quot;ID&quot;=&gt;&quot;CBT&quot;, &quot;R&quot;=&gt;&quot;22&quot;},
       {&quot;ID&quot;=&gt;&quot;330&quot;, &quot;R&quot;=&gt;&quot;1&quot;},
       {&quot;ID&quot;=&gt;&quot;00333&quot;, &quot;R&quot;=&gt;&quot;24&quot;, &quot;Sub&quot;=&gt;{&quot;ID&quot;=&gt;&quot;2&quot;, &quot;Typ&quot;=&gt;&quot;26&quot;}},
       {&quot;ID&quot;=&gt;&quot;3E3L&quot;, &quot;R&quot;=&gt;&quot;12&quot;},
       {&quot;ID&quot;=&gt;&quot;330B&quot;, &quot;R&quot;=&gt;&quot;38&quot;, &quot;Sub&quot;=&gt;{&quot;ID&quot;=&gt;&quot;2&quot;, &quot;Typ&quot;=&gt;&quot;26&quot;}},
       {&quot;ID&quot;=&gt;&quot;330&quot;, &quot;R&quot;=&gt;&quot;7&quot;}],
     &quot;RegTrdID&quot;=&gt;
      {&quot;ID&quot;=&gt;&quot;FECF155FADF8568LTP0202D90652E&quot;,
       &quot;Src&quot;=&gt;&quot;1010000023&quot;,
       &quot;Typ&quot;=&gt;&quot;0&quot;,
       &quot;Evnt&quot;=&gt;&quot;2&quot;}}}}}</pre>
          
          

          
          <div class="method-source-code" id="normalize_cme_eod-source">
            <pre><span class="ruby-comment"># File app/models/workers/normalizer.rb, line 225</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">normalize_cme_eod</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">system</span> = <span class="ruby-constant">System</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;CMEsys&#39;</span>)
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:system</span>] = <span class="ruby-identifier">system</span>

  <span class="ruby-identifier">entity</span> = <span class="ruby-constant">Entity</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;EMM&#39;</span>)
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:entity</span>] = <span class="ruby-identifier">entity</span>

  <span class="ruby-identifier">dealing_venue_alias_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;FIXML&#39;</span>][<span class="ruby-string">&#39;TrdCaptRpt&#39;</span>][<span class="ruby-string">&#39;Instrmt&#39;</span>][<span class="ruby-string">&#39;Exch&#39;</span>]

  <span class="ruby-identifier">dealing_venue_alias</span> = <span class="ruby-constant">DealingVenueAlias</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">system_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">system</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">code</span><span class="ruby-operator">:</span> <span class="ruby-identifier">dealing_venue_alias_code</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:dealing_venue</span>] = <span class="ruby-identifier">dealing_venue_alias</span>.<span class="ruby-identifier">dealing_venue</span>

  <span class="ruby-identifier">account</span> = <span class="ruby-constant">Builders</span><span class="ruby-operator">::</span><span class="ruby-constant">AccountBuilder</span>.<span class="ruby-identifier">build_from_cme_eod</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">claim</span> = <span class="ruby-constant">Builders</span><span class="ruby-operator">::</span><span class="ruby-constant">ClaimBuilder</span>.<span class="ruby-identifier">build_from_cme_eod</span>(<span class="ruby-identifier">params</span>)

  <span class="ruby-identifier">side</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;FIXML&#39;</span>][<span class="ruby-string">&#39;TrdCaptRpt&#39;</span>][<span class="ruby-string">&#39;RptSide&#39;</span>][<span class="ruby-string">&#39;Side&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;1&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-value">+1</span> <span class="ruby-operator">:</span> <span class="ruby-value">-1</span>

  <span class="ruby-identifier">exec_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;FIXML&#39;</span>][<span class="ruby-string">&#39;TrdCaptRpt&#39;</span>][<span class="ruby-string">&#39;ExecID&#39;</span>]
  <span class="ruby-identifier">trd_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;FIXML&#39;</span>][<span class="ruby-string">&#39;TrdCaptRpt&#39;</span>][<span class="ruby-string">&#39;TrdID&#39;</span>]

  <span class="ruby-identifier">hash</span> = {
      <span class="ruby-identifier">account_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">system_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">system</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">entity_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">entity</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">claim_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">claim</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">done</span><span class="ruby-operator">:</span> <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;FIXML&#39;</span>][<span class="ruby-string">&#39;TrdCaptRpt&#39;</span>][<span class="ruby-string">&#39;LastQty&#39;</span>]) <span class="ruby-operator">*</span> <span class="ruby-identifier">side</span>,
      <span class="ruby-identifier">price</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;FIXML&#39;</span>][<span class="ruby-string">&#39;TrdCaptRpt&#39;</span>][<span class="ruby-string">&#39;LastPx&#39;</span>],
      <span class="ruby-identifier">price_traded</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;FIXML&#39;</span>][<span class="ruby-string">&#39;TrdCaptRpt&#39;</span>][<span class="ruby-string">&#39;LastPx&#39;</span>],
      <span class="ruby-identifier">posted_on</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;FIXML&#39;</span>][<span class="ruby-string">&#39;TrdCaptRpt&#39;</span>][<span class="ruby-string">&#39;BizDt&#39;</span>],
      <span class="ruby-identifier">traded_on</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;FIXML&#39;</span>][<span class="ruby-string">&#39;TrdCaptRpt&#39;</span>][<span class="ruby-string">&#39;TrdDt&#39;</span>],
      <span class="ruby-identifier">traded_at</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;FIXML&#39;</span>][<span class="ruby-string">&#39;TrdCaptRpt&#39;</span>][<span class="ruby-string">&#39;TxnTm&#39;</span>],
      <span class="ruby-identifier">dealing_venue_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:dealing_venue</span>].<span class="ruby-identifier">id</span>,
      <span class="ruby-comment"># dealing_venue_done_id: params[&#39;FIXML&#39;][&#39;TrdCaptRpt&#39;][&#39;ExecID&#39;],</span>
      <span class="ruby-identifier">dealing_venue_done_id</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{exec_id} #{trd_id}&quot;</span>,

      <span class="ruby-identifier">packer_report_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:packer_report_id</span>],
      <span class="ruby-identifier">root</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:root</span>]
  }

  <span class="ruby-identifier">hash</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-normalize_cme_itd_fixml" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">normalize_cme_itd_fixml</span><span
            class="method-args">(fixml)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="normalize_cme_itd_fixml-source">
            <pre><span class="ruby-comment"># File app/models/workers/normalizer.rb, line 268</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">normalize_cme_itd_fixml</span>(<span class="ruby-identifier">fixml</span>)
  <span class="ruby-identifier">hash</span> = {}

  <span class="ruby-identifier">doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-identifier">fixml</span>)

  <span class="ruby-identifier">system</span> = <span class="ruby-constant">System</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;CME_FIX_ITD&#39;</span>)
  <span class="ruby-identifier">account_alias_code</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">&#39;FIXML TrdCaptRpt RptSide Pty&#39;</span>)[<span class="ruby-value">4</span>][<span class="ruby-string">&#39;ID&#39;</span>]
  <span class="ruby-identifier">account_alias</span> = <span class="ruby-constant">AccountAlias</span>.<span class="ruby-identifier">find_by_system_id_and_code</span>(<span class="ruby-identifier">system</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">account_alias_code</span>)

  <span class="ruby-identifier">claim</span> = <span class="ruby-identifier">cme_fixml_claim_mapper</span>(<span class="ruby-identifier">doc</span>, <span class="ruby-identifier">fixml</span>)

  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:account_id</span>] = <span class="ruby-identifier">account_alias</span>.<span class="ruby-identifier">account_id</span>
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:claim_id</span>] = <span class="ruby-identifier">claim</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:done</span>] = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">&#39;FIXML TrdCaptRpt&#39;</span>).<span class="ruby-identifier">first</span>[<span class="ruby-string">&#39;LastQty&#39;</span>].<span class="ruby-identifier">to_i</span>
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:done</span>] <span class="ruby-operator">*=</span> (<span class="ruby-identifier">doc</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">&#39;FIXML TrdCaptRpt RptSide&#39;</span>).<span class="ruby-identifier">first</span>[<span class="ruby-string">&#39;Side&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/1/</span>) <span class="ruby-operator">?</span> <span class="ruby-value">+1</span> <span class="ruby-operator">:</span> <span class="ruby-value">-1</span>
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:price</span>] = <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">doc</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">&#39;FIXML TrdCaptRpt&#39;</span>).<span class="ruby-identifier">first</span>[<span class="ruby-string">&#39;LastPx&#39;</span>])
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:price_traded</span>] = <span class="ruby-identifier">hash</span>[<span class="ruby-value">:price</span>]
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:posted_on</span>] = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">doc</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">&#39;FIXML TrdCaptRpt&#39;</span>).<span class="ruby-identifier">first</span>[<span class="ruby-string">&#39;BizDt&#39;</span>])
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:traded_on</span>] = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">doc</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">&#39;FIXML TrdCaptRpt&#39;</span>).<span class="ruby-identifier">first</span>[<span class="ruby-string">&#39;TrdDt&#39;</span>])

  <span class="ruby-identifier">hash</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-normalize_itd_abn_csv" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">normalize_itd_abn_csv</span><span
            class="method-args">(hash)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="normalize_itd_abn_csv-source">
            <pre><span class="ruby-comment"># File app/models/workers/normalizer.rb, line 94</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">normalize_itd_abn_csv</span>(<span class="ruby-identifier">hash</span>)
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>] = <span class="ruby-identifier">hash</span>[<span class="ruby-value">:csv</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>)

  <span class="ruby-comment"># WHAT TO DO IF I DON&#39;T HAVE THE KEY</span>
  <span class="ruby-comment"># WHAT TO DO IF I DON&#39;T HAVE THE KEY</span>
  <span class="ruby-comment"># WHAT TO DO IF I DON&#39;T HAVE THE KEY</span>
  <span class="ruby-comment"># WHAT TO DO IF I DON&#39;T HAVE THE KEY</span>
  <span class="ruby-comment"># WHAT TO DO IF I DON&#39;T HAVE THE KEY</span>
  <span class="ruby-comment"># WHAT TO DO IF I DON&#39;T HAVE THE KEY</span>
  <span class="ruby-comment"># WHAT TO DO IF I DON&#39;T HAVE THE KEY</span>
  <span class="ruby-comment"># WHAT TO DO IF I DON&#39;T HAVE THE KEY</span>

  <span class="ruby-comment"># replace GMI symbol with CLR symbol if known</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">79</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;05&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">80</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;SF&#39;</span>
    <span class="ruby-comment"># LIFFE</span>
    <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">80</span>]= <span class="ruby-string">&#39;I&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">79</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;27&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">80</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;SF&#39;</span>
    <span class="ruby-comment"># EUREX</span>
    <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">80</span>] = <span class="ruby-string">&#39;FESX&#39;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">key</span> = <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">80</span>]
    <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">80</span>] = <span class="ruby-constant">GMI2CLR</span>[<span class="ruby-identifier">key</span>] <span class="ruby-keyword">if</span> <span class="ruby-constant">GMI2CLR</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">key</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">system</span> = <span class="ruby-constant">System</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;AACC&#39;</span>)
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:system</span>] = <span class="ruby-identifier">system</span>

  <span class="ruby-identifier">entity</span> = <span class="ruby-constant">Entity</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-string">&#39;EMM&#39;</span>)
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:entity</span>] = <span class="ruby-identifier">entity</span>

  <span class="ruby-identifier">dealing_venue_alias_code</span> = <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">79</span>]

  <span class="ruby-identifier">dealing_venue_alias</span> = <span class="ruby-constant">DealingVenueAlias</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">system_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">system</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">code</span><span class="ruby-operator">:</span> <span class="ruby-identifier">dealing_venue_alias_code</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">hash</span>[<span class="ruby-value">:dealing_venue</span>] = <span class="ruby-identifier">dealing_venue_alias</span>.<span class="ruby-identifier">dealing_venue</span>

  <span class="ruby-identifier">account</span> = <span class="ruby-constant">Builders</span><span class="ruby-operator">::</span><span class="ruby-constant">AccountBuilder</span>.<span class="ruby-identifier">build_from_aacc_eod_csv</span>(<span class="ruby-identifier">hash</span>)
  <span class="ruby-identifier">claim</span> = <span class="ruby-constant">Builders</span><span class="ruby-operator">::</span><span class="ruby-constant">ClaimBuilder</span>.<span class="ruby-identifier">build_from_aacc_eod_csv</span>(<span class="ruby-identifier">hash</span>)

  <span class="ruby-identifier">side</span> = <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">20</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;1&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-value">+1</span> <span class="ruby-operator">:</span> <span class="ruby-value">-1</span>

  <span class="ruby-identifier">hash</span> = {
      <span class="ruby-identifier">account_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">system_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">system</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">entity_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">entity</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">claim_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">claim</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">done</span><span class="ruby-operator">:</span> <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">49</span>]) <span class="ruby-operator">*</span> <span class="ruby-identifier">side</span>,
      <span class="ruby-identifier">price</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">19</span>],
      <span class="ruby-identifier">price_traded</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">87</span>],
      <span class="ruby-identifier">posted_on</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">-1</span>],
      <span class="ruby-identifier">traded_on</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">18</span>],
      <span class="ruby-identifier">traded_at</span><span class="ruby-operator">:</span> <span class="ruby-identifier">reformat_aacc_eod_csv_time</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value">:ary</span>][<span class="ruby-value">129</span>]),
      <span class="ruby-identifier">dealing_venue_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:dealing_venue</span>].<span class="ruby-identifier">id</span>,
      <span class="ruby-identifier">dealing_venue_done_id</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{hash[:ary][18]} #{hash[:ary][24]}&quot;</span>,

      <span class="ruby-identifier">packer_report_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:packer_report_id</span>],
      <span class="ruby-identifier">root</span><span class="ruby-operator">:</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value">:root</span>]
  }

  <span class="ruby-identifier">hash</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-reformat_aacc_eod_csv_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_aacc_eod_csv_time</span><span
            class="method-args">(str)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="reformat_aacc_eod_csv_time-source">
            <pre><span class="ruby-comment"># File app/models/workers/normalizer.rb, line 155</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reformat_aacc_eod_csv_time</span>(<span class="ruby-identifier">str</span>)
  [<span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">2</span>], <span class="ruby-identifier">str</span>[<span class="ruby-value">2</span>, <span class="ruby-value">2</span>], <span class="ruby-identifier">str</span>[<span class="ruby-value">4</span>, <span class="ruby-value">2</span>]].<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;:&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

